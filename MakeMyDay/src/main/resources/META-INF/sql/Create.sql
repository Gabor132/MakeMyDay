-- SQL SCRIPT FOR GENERATING THE NECESARY TABLES ON THE SCHEMA --
CREATE TABLE EVENT_TYPES (ID INT(3) AUTO_INCREMENT PRIMARY KEY, TYPE VARCHAR(20) NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE SITE_TEMPLATES (ID INT(4) AUTO_INCREMENT PRIMARY KEY, NAME VARCHAR(30) NOT NULL, EVENT_URL_TYPE VARCHAR(20) NOT NULL, CONTENT_TYPE INT(3) NOT NULL DEFAULT 1, LINK VARCHAR(255) NOT NULL, DATE_FORMAT VARCHAR(30) NOT NULL, FOREIGN KEY(CONTENT_TYPE) REFERENCES EVENT_TYPES(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE ITEM_TEMPLATES (ID INT(4) AUTO_INCREMENT PRIMARY KEY, NAME VARCHAR(30) NOT NULL, SITE_ID INT(4), FOREIGN KEY(SITE_ID) REFERENCES SITE_TEMPLATES(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE ITEM_CLASSES (ID INT(7) AUTO_INCREMENT PRIMARY KEY, CLASS_NAME VARCHAR(30) NOT NULL, CLASS_TYPE VARCHAR(20) NOT NULL, VALUE_TYPE VARCHAR(20) NOT NULL, VALUE_LOCATION VARCHAR(30), PARENT_CLASS_ID INT(7), ITEM_ID INT(4), FOREIGN KEY(PARENT_CLASS_ID) REFERENCES ITEM_CLASSES(ID), FOREIGN KEY(ITEM_ID) REFERENCES ITEM_TEMPLATES(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE EVENTS (ID INT(10) AUTO_INCREMENT PRIMARY KEY, NAME VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_romanian_ci NOT NULL UNIQUE, TYPE_ID INT(3) NOT NULL, IMAGE_URL VARCHAR(255), DATE_EVENT TIMESTAMP NOT NULL, ADDRESS VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_romanian_ci NOT NULL, PRICE VARCHAR(30) CHARACTER SET utf8 COLLATE utf8_romanian_ci, DESCRIPTION VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_romanian_ci, LINK VARCHAR(255), SITE_ID INT(4), FOREIGN KEY(SITE_ID) REFERENCES SITE_TEMPLATES(ID), FOREIGN KEY(TYPE_ID) REFERENCES EVENT_TYPES(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE USERS (ID INT(6) AUTO_INCREMENT PRIMARY KEY, EMAIL VARCHAR(255) NOT NULL UNIQUE, PASSWORD BINARY(64) NOT NULL, TYPE VARCHAR(20) NOT NULL DEFAULT 'NORMAL') ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE PLANS (ID INT(10) AUTO_INCREMENT PRIMARY KEY, USER_ID INT(6), PLAN_DATE DATE NOT NULL, FOREIGN KEY(USER_ID) REFERENCES USERS(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE PLAN_EVENTS (PLAN_ID INT(10), EVENT_ID INT(10), PRIMARY KEY(PLAN_ID, EVENT_ID), FOREIGN KEY (PLAN_ID) REFERENCES PLANS(ID), FOREIGN KEY (EVENT_ID) REFERENCES EVENTS(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE ACCESS_LOGS (ID INT(20) AUTO_INCREMENT PRIMARY KEY, USER_ID INT(6), TOKEN VARCHAR(255) NOT NULL, EXPIRATION_TIMESTAMP TIMESTAMP NOT NULL, FOREIGN KEY(USER_ID) REFERENCES USERS(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE PREFERENCES (USER_ID INT(10) NOT NULL, EVENT_TYPE INT(3) NOT NULL, PRIMARY KEY(USER_ID, EVENT_TYPE), FOREIGN KEY(USER_ID) REFERENCES USERS(ID), FOREIGN KEY(EVENT_TYPE) REFERENCES EVENT_TYPES(ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8 DEFAULT COLLATE utf8_romanian_ci;
CREATE TABLE KEY_WORDS(ID INT(3) AUTO_INCREMENT PRIMARY KEY, WORD VARCHAR(20) CHARACTER SET utf8 COLLATE utf8_romanian_ci NOT NULL UNIQUE);
CREATE TABLE EVENT_TYPE_WORDS (EVENT_TYPE_ID INT(3), KEY_WORD_ID INT(3), PERCENTAGE DECIMAL(3,2) DEFAULT 0, FOREIGN KEY(EVENT_TYPE_ID) REFERENCES EVENT_TYPES(ID), FOREIGN KEY(KEY_WORD_ID) REFERENCES KEY_WORDS(ID), PRIMARY KEY(EVENT_TYPE_ID, KEY_WORD_ID)); 